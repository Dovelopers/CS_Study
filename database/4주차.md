# 데이터베이스 CS 스터디 4주차

데이터베이스 4주차 스터디입니다.

한빛아카데미의 `MySQL로 배우는 데이터베이스 개론과 실습` 책을 기반으로 작성했습니다.

작성자 : YMGYM(안민준)

## 개요

지난 시간에는 릴레이션에서 원하는 결과를 얻기 위해 사용하는 관계 대수에 대해서 알아 보았습니다.

또한 관계 대수가 수학적으로 어떻게 모델링 되었는지 (관계 데이터베이스는 수학 대수 연산을 기반으로 하였으므로) 알아 보았습니다.

또한 관계 대수를 표현하는 방법인 관계 대수 연산에 대해서 공부했습니다.

이번 시간에는 지난 시간에 배운 관계 대수 연산 `셀렉션` 과 `프로젝션` 에 이어서 다른 관계 대수 연산을 알아 보도록 하겠습니다.

## 집합 연산

지난 시간에 공부했듯 관계 대수 연산의 집합 연산도 수학과 같은 방법으로 연산합니다.

다음과 같은 방법으로 분류됩니다.

기본 연산자

- 합집합 : `∪`

- 차집합 : `-`

- 카티전 프로덕트 : `X`

유도 연산자

- 교집합 : `∩` ; `R∩S = R-(R-S)`

또한 두 개의 릴레이션을 대상으로 하는 이항 연산자이며,

카티전 프로덕트를 제외한 연산은 두 릴레이션의 차수 및 도메인과 속성의 순서까지 동일해야 연산이 됩니다. 이 조건을 합병가능(Union Compatible) 이라고 합니다. 이 때 속성 이름은 동일하지 않아도 되며, 이 경우 반환되는 속성명은 첫 번째 릴레이션의 속성명이 됩니다.

### 합집합

합병가능한 두 개의 릴레이션을 합하여 하나의 릴레이션을 반환합니다. 

`R ∪ S` 와 같이 사용합니다.

- 결과 릴레이션의 차수 : 두 릴레이션과 동일

- 카디날리티 : 대상 릴레이션들의 카디날리티 합보다 작거나 같다

![](https://blog.kakaocdn.net/dn/B3Vc9/btrq7T1lDHj/YnNg97J1BSJTEBxrD9iNkk/img.png)

출처 : [[문과 코린이의 IT 기록장] MSSQL - 집합 연산자 (관계형 데이터베이스(DBMS) vs 집합, 합집합, 차집합, 교집합, 곱집합, 프로젝션, 셀렉션, 조인/디비전)](https://vansoft1215.tistory.com/229)

이 때 반환된 릴레이션의 카디널리티는 두 집합의 카디널리티 합 보다 작을 수 있습니다

중복된 투플의 경우는 하나로 연산되기 때문입니다. (릴레이션은 중복을 허용하지 않습니다.)

### 교집합

합병가능한 두 개의 릴레이션을 합하여 두 릴레이션이 공통으로 가지고 있는 투플을 반환합니다.

`R ∩ S` 와 같이 사용합니다.

- 결과 릴레이션의 차수 : 두 릴레이션과 동일

- 카디날리티 : 대상 릴레이션들의 카디날리티 합보다 작거나 같다

![](https://blog.kakaocdn.net/dn/cbGPbS/btrq4ql2WBS/SK9rTrJieUcDlYsZWVzehK/img.png)

출처 : [[문과 코린이의 IT 기록장] MSSQL - 집합 연산자 (관계형 데이터베이스(DBMS) vs 집합, 합집합, 차집합, 교집합, 곱집합, 프로젝션, 셀렉션, 조인/디비전)](https://vansoft1215.tistory.com/229)

### 차집합

합병가능한 두 개의 릴레이션 중 첫 번째 릴레이션에는 속하고 두 번째 릴레이션에는 속하지 않는 투플을 반환합니다.

`R - S` 와 같이 사용합니다.

- 결과 릴레이션의 차수 : 두 릴레이션과 동일

- 카디날리티 : 왼쪽 릴레이션의 카니날리티보다 작거나 같다.

![](https://blog.kakaocdn.net/dn/dzbK12/btrq4w0CwSb/kl2WLZ7tEejv0KZlNxjpk0/img.png)

출처 : [[문과 코린이의 IT 기록장] MSSQL - 집합 연산자 (관계형 데이터베이스(DBMS) vs 집합, 합집합, 차집합, 교집합, 곱집합, 프로젝션, 셀렉션, 조인/디비전)](https://vansoft1215.tistory.com/229)

### 카티전 프로덕트

카티전 프로덕트는 두 릴레이션을 하나로 연결시킬 때 사용합니다.

첫 번째 릴레이션의 모든 레코드 옆에 두 번째 릴레이션의 모든 레코드를 연결하여 나타냅니다.

`R X S` 와 같이 표현합니다.

- 결과 릴레이션의 차수 : 두 릴레이션의 차수의 합

- 카디날리티 : 두 릴레이션의 카디날리티의 곱

두 릴레이션의 레코드를 연결하기 때문에 속성명은 릴레이션에서 그대로 받아 오지만, 이 때 속성 이름이 중복되는 경우 `릴레이션 이름.속성 이름` 과같은 방법으로 주로 사용합니다.

![](https://blog.kakaocdn.net/dn/dOpLTt/btrq4regtG0/XznyRZVjR3P7ziZpcnqXXK/img.png)

출처 : [[문과 코린이의 IT 기록장] MSSQL - 집합 연산자 (관계형 데이터베이스(DBMS) vs 집합, 합집합, 차집합, 교집합, 곱집합, 프로젝션, 셀렉션, 조인/디비전)](https://vansoft1215.tistory.com/229)

## 조인

카티전 프로젝트의 결과값은 두 릴레이션을 합치 연산만을 보여주기 때문에 대부분 결과에 의미가 없습니다. 따라서 이 결과물에서 의미 있는 결과만을 추려 내는 작업을 해야 하는데, 이 작업을 '조인'으로 수행합니다.

조인은 두 릴레이션의 공통 속성을 기준으로 속성 값이 같은 투플을 수평으로 결합하는 연산입니다.

수학적으로 정의하면 '카티전 프로덕트 연산 수행 -> 속성 값이 같은지를 기준으로 하여 셀렉션 연산 수행'의 과정이라고 볼 수 있습니다.

조인 연산은 `⋈` 를 사용하여 나타내며, 이는 기본 연산자들의 조합으로 구현 가능한 (카티전 프로덕트 + 셀렉션 등) 유도 연산자입니다. 또한 두 개의 릴레이션을 대상으로 하는 이항 연산자입니다.

`R ⋈<C> S = σ<c>(RXS)` 와 같이 표기합니다.

당연히 조인을 수행하기 위해서는 조인에 참여하는(같은 값인지 비교하는) 속성의 도메인은 서로 같아야 합니다.

조인에는 아래와 같은 종류가 있습니다.

기본 조인 연산

- 세타조인 : `⋈<θ>`

- 동등조인 : `⋈`

- 자연조인: `⋈<n>`

확장된 조인 연산 

- 세미 조인 : `⋉`

- 외부 조인 : `⟕`

### 세타 조인

조인에 참여하는 두 릴레이션의 속성 값을 비교하여 조건을 만족하는 투플만 반환합니다.

세타조건의 조건은 { =, >, < } 등 비교 연산자가 포함될 수 있습니다.

세타 조인은 `R ⋈<r조건 s> S` 와 같이 작성합니다.

### 동등조인

세타 조인에서 연산자가 `=` 인 케이스만을 동등조인이라고 합니다.

`R ⋈<조건=조건> S` 와 같은 형태를 나타냅니다.

- 결과 릴레이션의 차수 : 두 릴레이션의 차수의 합

![동등조인의 예시](https://agilestarskim.github.io/static/2630f2b804471323df6ded4d62bb22aa/6a068/database04-05.jpg)

출처 : https://agilestarskim.github.io/posts/what-is-database-04

### 자연 조인

동등 조인의 결과는 조인에 사용된 속성이 두개 모두 나타나는 것을 확인할 수 있습니다.

(위 사진에서 고객 번호가 둘)

자연 조인은  동등조인에서 조인에 참여한 속성이 두 번 나오지 않게 속성 하나를 제외한 결과를 반환합니다.

`R ⋈<n(r,s)> S` 와 같이 나타냅니다.

- 결과 릴레이션의 차수 : 두 릴레이션의 차수의 합 - 1

![](https://t1.daumcdn.net/cfile/blog/271D874757EFACB634)

출처 : [황효정](https://blog.daum.net/vkfksskfk2/12)

### 외부 조인

외부 조인은 자연조인의 확장된 형태입니다.

자연조인 시 조인에 실패한 투플은 모두 보여주되 값이 없는 대응 속성에는 NULL을 넣어 반환합니다.

값이 있는지 없는지를 파악하는 기준 릴레이션의 위치에 따라 아래와 같이 나타냅니다.

- 왼쪽 외부조인 (Left Outer Join) : `⟕`

- 오른쪽 외부조인 (Right Outer Join) : `⟖`

- 완전 외부조인 (Full Outer Join) : `⟗`

`R ⟗ <r, s> S` 와 같은 형태로 사용합니다.

![다양한 조인(JOIN)기법 — hyeonsig notes](https://t1.daumcdn.net/cfile/tistory/27780A4154267F5C33)

출처 : [다양한 조인(JOIN)기법 — hyeonsig notes](https://hyeonsig.tistory.com/entry/lab-note-sql-join-method)

### 세미 조인

세미 조인은 자연 조인을 한 후 두 릴레이션 중 한쪽 릴레이션의 결과만 반환합니다.

`R ⋉ <(r, s)> S`  와 같이 작성하며 기호에서 닫힌 쪽 릴레이션의 투플만 반환하게 됩니다.

즉 열린쪽 릴레이션에 존재하지 않는 닫힌 쪽 투플을 반환한다고 볼 수 있습니다.

출처 : [[정보처리][관계DB] 09. 관계 데이터 연산 : 네이버 블로그](https://m.blog.naver.com/PostView.naver?blogId=syunjae21&logNo=221986984722)

### 디비전

속성 값의 집합으로 연산을 수행하게 됩니다.

특정 값들을 모두 가지고 있는 투플을 찾을 때 사용합니다.

![디비전 예시](https://agilestarskim.github.io/static/c12d91ee37a8f8b5e330636e75b21b6f/6a068/database04-06.jpg)

출처 : https://agilestarskim.github.io/posts/what-is-database-04

(자주 수행하지 않으며, 연산의 조합으로도 수행할 수 있습니다.)

## 관계대수 연산자의 복합 사용

카티전 프로덕트와 조인 연산은 비슷한 역할을 수행하므로 섞어서 사용할 수 있습니다.

예를 들어 카티전 프로젝트를 수행한 결과에 일부를 셀렉션, 프로덕트를 하는 경우,

`π<주문.주문번호, 고객.고객이름, 주문. 판매가격>(σ<... 고객.고객번호=주문.주문번호> (고객 X 주문)` 의 경우, 조인을 사용하면

`π<주문번호, 고객이름, 판매가격>(σ<...> (고객 ⋈<고객.고객번호=주문.주문번호> 주문)` 으로 간단히 표현할 수 있습니다.

DBMS는 우리가 쿼리를 날릴 때 Query Optimization(질의 최적화) 과정을 거쳐 같은 결과를 내는 여러 대수식을 생성하고, 그 중 가장 효율적인 대수식을 생성하여 처리한다고 합니다.

#### 

# 참고 자료

- [[문과 코린이의 IT 기록장] MSSQL - 집합 연산자 (관계형 데이터베이스(DBMS) vs 집합, 합집합, 차집합, 교집합, 곱집합, 프로젝션, 셀렉션, 조인/디비전)](https://vansoft1215.tistory.com/229)
- https://agilestarskim.github.io/posts/what-is-database-04
- [황효정](https://blog.daum.net/vkfksskfk2/12)
- [다양한 조인(JOIN)기법 — hyeonsig notes](https://hyeonsig.tistory.com/entry/lab-note-sql-join-method)
