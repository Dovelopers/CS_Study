# 데이터베이스 CS 스터디 5주차

데이터베이스 5주차 스터디입니다.

한빛아카데미의 `MySQL로 배우는 데이터베이스 개론과 실습` 책을 기반으로 작성했습니다.

작성자 : YMGYM(안민준)

## 개요

지난 시간까지 우리는 데이터베이스에 사용되는 개념적인 내용들을 배웠습니다.

지금까지는 개념적인 내용을 배웠다면, 이번 시간에는 실제 데이터베이스를 다루는 SQL에 대해서 공부하겠습니다.

이번 스터디 목적이 SQL 을 잘 다루는 것이 아니기 때문에 SQL 에 대해서 깊게 공부하지는 않겠지만, 간단하게 어떤 종류가 있는지는 알고 넘어가도록 하겠습니다.

## 개념 짚기

지금까지는 관계 데이터베이스를 수학적 모델에 근거하여 알아보았습니다. 따라서 이를 모델링한 릴레이션 개념으로 주로 살펴보았는데, 앞으로는 실무에서 주로 사용하는(책의 주장) 용어 또한 포함해서 부르도록 하겠습니다.

| 릴레이션 용어       | 실무 용어     | 파일 시스템 용어 |
| ------------- | --------- | --------- |
| 릴레이션          | 테이블       | 파일        |
| 속성(attribute) | 열(column) | 필드        |
| 투플(tuple)     | 행(row)    | 레코드       |

## SQL

SQL은 DBMS에게 원하는 내용을 알려주고 결과를 얻는 데 사용하는 데이터베이스 전용 언어입니다.

1970년대 SEQUEL 이란 이름으로 개발되었으며, 이후 ANSI에 의해 1986년 관계형 데이터베이스 표준 언어로 승인되었다고 합니다.

SQL은 데이터베이스에 관련된 조작만 수행할 수 있기 때문에 완전한 프로그래밍 언어가 아니라 '데이터 부속어' (data sublanguage)' 라고 부릅니다.



### SQL 와 일반 프로그래밍 언어의 차이점

| 구분  | SQL                         | 일반 프로그래밍 언어 |
| --- | --------------------------- | ----------- |
| 용도  | 데이터베이스에서 데이터 추출 하여 관련 문제 해결 | 모든 문제 해결    |
| 입출력 | 모두 테이블로 이루어짐                | 모든 형태의 입출력  |
| 번역  | DBMS                        | 컴파일러        |



### SQL의 분류

SQL은 기능에 따라 아래 분류로 나뉩니다

- 데이터 정의어 (DDL - Data Definition Language) : 테이블이나 관계의 구조 생성 CREATE, ALTER, DROP 문 등이 있음

- 데이터 조작어 (DML - Data Manipulation Language) : 테이블에 데이터를 삽입, 수정, 삭제

- 데이터 제어어 (DCL - Data Control Language) : 데이터의 사용 권한을 관리. GRANT, REVOKE 문 등



### SQL 문의 특징

SQL 은 실행 순서가 없는 비절차적 언어 (non-procedural) 입니다.

찾는 데이터만 기술하고 찾는 순서는 기술하지 않는 언어입니다.

하지만 위와 같이SQL이 실행되면 DBMS에 의하여 아래 순서대로 처리됩니다.

```sql
SELECT phone
FROM Customer
WHERE name='안민준';
```

1. FROM 절에 적힌 테이블을 가지고 옴

2. WHERE 절 조건에 의해 투플을 선택

3. SELECT 절에 있는 속성들을 결과로 출력



## 부속질의 (Subquery)

SQL 문 안에 다른 SQL문이 중첩되어 있는 질의를 부속질의라고 합니다.

테이블 두 개의 정보를 합쳐서 봐야 하는 경우, 조인(join)과 부속질의(subquery) 둘 중 하나를 선택해서 보여 주어야 합니다.

두 방법 중 어떤 방법을 사용해도 상관 없지만, 일반적으로 데이터가 대량인 경우는 데이터를 모두 합쳐는 조인 연산보다 필요한 데이터만 필터링 한 후 계산하는 부속질의가 성능이 더 좋은 편입니다.



부속질의는 총 3가지 종류가 있으며, 아래와 같이 분류됩니다.

- 스칼라 부속질의

- 인라인 뷰

- 중첩질의



### 스칼라 부속질의 - SELECT 부속질의

스칼라 부속질의는 SELECT 절에서 사용하는 부속질의로 부속질의의 결과 값을 단일 행, 단일 열의 스칼라 값으로 반환합니다.

만약 결과 값이 다중 행 또는 다중 열이면 DBMS 는 어떠한 값을 선택해야 하는지 알 수 없어 오류를 반환하게 됩니다.

원칙적으로 스칼라 값이 들어갈 수 있는 모든 자리에 사용이 가능합니다.

예를 들면 아래와 같이 쓸 수 있습니다.

```sql
SELECT
    (SELECT name FROM Customer cs WHERE cs.custId=od.custId) 'name,
    ...
FROM
    orders od
GROUP BY od,custId;
```

(이때 부속질의문의 `od.custId` 처럼 주질의의 값을 상속받아 사용하는 것을 '상관 부속질의' 라고 합니다.)

### 인라인 뷰 - FROM 부속질의

뷰 (View) 는 일시적으로 만들어진 가상 테이블을 의미합니다. (후에 설명합니다)

SQL 문의 FROM 절에 적을 수 있어서 FROM 부속질의라고 표현합니다.

먼저 부속질의를 계산해서 가상 테이블을 만들고 이를 사용하여 주질의를 계산하게 됩니다.

아래와 같이 사용할 수 있습니다.

```sql
SELECT
    cs.name, ...
FROM 
    (SELECT custId, name FROM Customer WHERE ...) cs,
    Orders od
...
```



### 중첩 질의 - WHERE 부속질의

WHERE 절에서 사용되는 부속질의는 중첩질의라고 합니다. 데이터를 선택하는 조건이나 술어(predicate)와 같이 사용하기 때문에 술어 부속질의라고도 합니다.

주질의의 자료 집합에서 한 행씩 가져와 부속질의를 수행하며, 연산 결과 참 거짓을 판단하여 주질의의 행을 표시할지 결정합니다.

아래와 같은 종류로 들 수 있습니다.

| 술어  | 연산자                 | 반환 행 | 반환 열 | 상관  |
| --- | ------------------- | ---- | ---- | --- |
| 비교  | =, >, <, >=, <=, <> | 단일   | 단일   | 가능  |
| 집합  | IN, NOT IN          | 다중   | 다중   | 가능  |
| 한정  | ALL, SOME           | 다중   | 단일   | 가능  |
| 존재  | EXISTS, NOT EXISTS  | 다중   | 다중   | 필수  |



#### 비교 연산자

비교 연산자는 부속질의가 반드시 단일 행, 단일 열을 반환해야 합니다.

주질의의 대상 열 값과 부속질의의 결과 값을 비교 연산자에 적용하고, 참이면 출력합니다.

```sql
SELECT
    orderId, saleprice
FROM
    Orders o1
WHERE saleprice <= (
        SELECT AVG(saleprice) FROM Orders o2 WHERE o1.custId=o2.custId
      );
```

여기서 AVG 함수는 단일 행, 열을 반환하기 때문에 비교 연산자 부속질의의 조건에 일치합니다.

또한 주질의의 값과 부속질의의 값을 비교하므로 상관 부속질의 형태임을 확인할 수 있습니다.



#### 집합 연산자

IN 연산자는 주질의의 속성 값이 부속질의의에서 제공한 결과 집합에 존재하는지를 확인하고, NOT IN 연산자는 그 반대입니다.

```sql
SELECT  SUM(saleprice)
FROM Orders
WHERE custId IN (
    SELECT custId FROM Customer  
);
```

#### 한정 연산자

ALL 연산자는 '모든'을 나타내며, 부속질의의 모든 값에 대해 참이어야 합니다.

SOME 연산자는 '어떤'을 나타내며, 부속질의의 모든 값에 대해 최소한 하나라도 참이어야 합니다.

```sql
SELECT orderId
FROM Orders
WHERE saleprice > ALL (
    SELECT saleprice
    FROM Orders
    WHERE custId='3'
);
```

이 경우 saleprice 가 custid 가 3인 고객의 모든 주문금액보다 큰 경우만 반환하므로 `MAX(saleprice)` 와 같다고 볼 수 있습니다.

SOME을 사용한 경우 `MIN(saleprice)` 와 같다고 볼 수 있습니다.



#### 존재 연산자

EXIST 와 NOT EXISTS 는 데이터의 존재 유무를 확인합니다.

EXIST의 경우 부속질의에 제공된 속성을 가지고 결과가 존재하면 참이 되고 표시합니다.

NOT EXISTS의 경우 이 반대로 수행합니다.

EXISTS 연산자의 경우 왼쪽에 스칼라 값이나 열을 명시하지 않기 때문에 반드시 상관 질의 형태여야 합니다.

```sql
SELECT SUM(saleprice)
FROM Orders od
WHERE EXISTS (
    SELECT *
    FROM Customer cs
    WHERE cs.custId=od.custId
);
```

# 참고 자료

- 한빛아카데미 'MySQL로 배우는 데이터베이스 개론과 실습', 박우창 외 2명
